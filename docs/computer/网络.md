# 网络

与其他电脑进行交流

## IP地址

当设备连接网络，设备将被分配一个IP地址，用作标识。

通过IP地址，设备间可以互相通讯，如果没有IP地址，我们将无法知道哪个设备是发送方，无法知道哪个是接收方

一般IP地址分为: `IPv4` 和 `IPv6`两大类

IPv4: 32位二进制数组成

IPv6: 128位二进制数组成

## IP协议

根据源主机和目的主机的地址来传送数据

IP定义了寻址方法和数据报的封装结构


## UDP

`User Datagram Protocol` 用户数据报协议

尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态

无连接 位于传输层

## TCP

`Transmisson Control Protocol`  传输控制协议

提供可靠交付的服务。通过TCP连接传送的数据，无差错、不丢失、不重复、并且按序到达

三个阶段: 创建通道 -> 数据传输 -> 通道关闭

面向连接 位于传输层

三次握手（创建通道）

1. 客户端发送`SYN`(连接请求)到服务器
2. 服务端接受`SYN`(连接请求)并回返一个`SYN/ACK`(连接确认)
3. 客服端收到`SYN/ACK`, 发送`ACK`(确认)

> 如果中间客户端掉线了？？ 

>如果服务器端接到了客户端发的SYN后回了SYN-ACK后客户端掉线了，服务器端没有收到客户端回来的ACK，那么，这个连接处于一个中间状态，既没成功，也没失败。于是，服务器端如果在一定时间内没有收到的TCP会重发SYN-ACK。在Linux下，默认重试次数为5次，重试的间隔时间从1s开始每次都翻倍，5次的重试时间间隔为1s, 2s, 4s, 8s, 16s，总共31s，第5次发出后还要等32s才知道第5次也超时了，所以，总共需要 1s + 2s + 4s+ 8s+ 16s + 32s = 63s，TCP才会断开这个连接。使用三个TCP参数来调整行为：tcp_synack_retries 减少重试次数；tcp_max_syn_backlog，增大SYN连接数；tcp_abort_on_overflow决定超出能力时的行为。

四次挥手(关闭通道)

1. 客户端发出连接释放(`FIN`)的请求
2. 服务端收到连接释放报文(`FIN`)，发出确认(`ACK`)报文
3. 服务端确认将数据传送完毕之后, 向客户端发送连接释放(`FIN`)报文
4. 客户端收到连接释放报文, 发送确认(`ACK`)报文

TCP如何提供传输的可靠性?

1. 在每个TCP报文段中都有一对序号和确认号, TCP报文的接收者为了确保可靠性，在接收到一定数量的连续字节流后才发送确认 -> 选择确认
  1. 选择确认使得TCP接收者可以对乱序到达的数据块进行确认。每一个字节传输过后，SN号都会递增1。
2. 数据分割, 应用数据被分割成TCP认为的最合适的长度进行发送
3. 重传, 当TCP发出一个报文段后, 它启动一个定时器,等待目的端确认收到这个报文段。如果不能及时收到则重发
4. TCP将保持它首部和数据的校验. 如果有差错抛弃


## HTTP

`HyperText Transfer Protocol` 超文本传输协议，默认80端口

1. `Connection: Keep-Alive` 使用同一个TCP连接来发送和接收多个HTTP请求/应答，而不是为每一个新的请求/应答打开新的连接的方法。

### HTTP2.0

和HTTP1的区别

1. 二进制传输, 之前的数据传输使用的是文本, 现在使用的传输方式是二进制
2. 多路复用。
帧和流。 帧代表着最小的数据单位，每个帧会标识出该帧属于哪个流，流也就是多个帧组成的数据流。
多路复用，就是在一个 TCP 连接中可以存在多条流。换句话说，也就是可以发送多个请求，对端可以通过帧中的标识知道属于哪个请求。通过这个技术，可以避免 HTTP 旧版本中的队头阻塞问题，极大的提高传输性能。
3. Header压缩
4. 服务端Push。 服务端可以在客户端某个请求后，主动推送其他资源。

### HTTPS

`HyperText Transfer Protocol Secure` 超文本传输安全协议，默认443接口

HTTPS 还是通过了 HTTP 来传输信息，但是信息通过 TLS 协议进行了加密。

在 TLS 中使用了两种加密技术，分别为：对称加密和非对称加密。

对称加密: 两边持有相同的密钥

非对称加密: 有公钥私钥之分，公钥所有人都可以知道，可以将数据用公钥加密，但是将数据解密必须使用私钥解密，私钥只有分发公钥的一方才知道。


## DNS

DNS域名解析

1. 浏览器搜索自己的 DNS 缓存
2. 查找本地操作系统
3. 查找本地系统`/etc/hosts（mac）`
4. 在本地区域名服务器进行查找

位于应用层

### URL输入之后到页面加载完成,都经历了什么

1. DNS查询
2. TCP握手
3. web浏览器向web服务器发送HTTP报文
4. 数据在进入服务端之前, 会经过负载均衡，服务器返回html
5. 浏览器判断状态码, 200继续解析, 300重定向, 400和500会报错
6. 浏览器解析文件，如果是gzip格式的话需要解压, 根据文件的编码格式进行解码
7. 构建DOM Tree, CSSOM
8. CSSOM树和DOM树构建完成后会开始生成Render树
9. 浏览器就开始调用GPU绘制，合成图层，将内容显示在屏幕上了

## FTP

`File Transfer Protocol` 文件传输协议

## SMTP

`Simple Mail Transfer Protocol` 简单邮件传输协议

## SSH

`Secure Shell` 加密的网络协议

